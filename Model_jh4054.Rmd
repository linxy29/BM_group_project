---
title: "Model_jh4054"
author: "Joy Hsu"
date: "12/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  message = FALSE,
  warning = FALSE)

library(tidyverse)
```

### Load Main dataset

```{r}
cancer_reg = read_csv("./data/Cancer_Registry.csv") %>%
  janitor::clean_names() %>%
  select(target_death_rate, everything()) %>%
  separate(geography, into = c("county", "state"), sep = ", ") %>% 
  mutate(
    avg_deaths_per_year = as.numeric(avg_deaths_per_year),
    med_income = as.numeric(med_income),
    pop_est2015 = as.numeric(med_income),
    county = str_replace(county, " ", ""),
    log_med_income = log(med_income))
```

### Explore correlations

```{r}
# corrplot::corrplot(cancer_reg)

# look at character strings
str(cancer_reg)

# correlation plots
cancer_reg %>% 
  select(-county, -binned_inc, -state) %>% 
  select(pct_ , med_income, poverty_percent) %>% GGally::ggpairs()

# scatterplot b/w variables
cancer_reg %>% 
  ggplot(aes(x = percent_smoke, y = target_death_rate)) +
  geom_point()

# test relationship b/w ever smoking rates and cancer mortality incidence
fit1 = lm(target_death_rate ~ percent_smoke, data = cancer_reg)
summary(fit1)
```

### Variables to Transform

### Collinear Variables

1) med_income, poverty_percent. Keep *poverty_percent*, stronger linear rel with explanatory variable

2) Edudation variables

### Add Smoking Pravalence (current/previous smokers)

* Lung cancer account for highest proportion of cancer deaths. ~20% of lung cancer patients have never smoked. Smoking prevalence within a state is important indicator for mortality. 
```{r}
tobacco_2013 = read_csv(file = "./data/BRFD_tobacco_2010_present.csv") %>% 
  janitor::clean_names() %>% 
  filter(response == "Never", year == "2013", gender == "Overall") %>% 
  dplyr::select(year = "year", state = "location_desc", response, percent_never = "data_value") %>%
  mutate(
    percent_smoke = as.numeric(100 - percent_never),
    year = as.numeric(year)) %>% 
  dplyr::select(state, percent_smoke) %>% 
  filter(state != c("Guam", "National Median (States and DC)", "Puerto Rico"))

cancer_reg = left_join(cancer_reg, tobacco_2013, by = "state") %>% 
  dplyr::select(target_death_rate, state, percent_smoke, everything())

cancer_reg %>% 
  distinct(state, percent_smoke)
```

### Look at toxic waste
```{r}
cancer_county_chem_pop = readRDS("./data/cancer_county_chem_pop.rds") %>% 
  janitor::clean_names() %>% 
  ungroup() %>% 
  filter(
    total_rel_summ != 0,
    pop_est > 50000) %>% 
  mutate(
    chemical = purrr::map(chemical, tolower),
    chemical = str_replace(chemical, " ", "_"),
    total_rel_log = log(total_rel_summ))
```

